<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Topic 3 RCT（ランダム化比較試験） | KUT 計量経済学応用</title>
  <meta name="description" content="Topic 3 RCT（ランダム化比較試験） | KUT 計量経済学応用" />
  <meta name="generator" content="bookdown 0.18 and GitBook 2.6.7" />

  <meta property="og:title" content="Topic 3 RCT（ランダム化比較試験） | KUT 計量経済学応用" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Topic 3 RCT（ランダム化比較試験） | KUT 計量経済学応用" />
  
  
  

<meta name="author" content="矢内 勇生" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="selection-bias.html"/>
<link rel="next" href="regression.html"/>
<script src="libs/header-attrs-2.2/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/htmlwidgets-1.5.1/htmlwidgets.js"></script>
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.11/datatables.js"></script>
<link href="libs/dt-core-1.10.19/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.10.19/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.10.19/js/jquery.dataTables.min.js"></script>
<link href="libs/crosstalk-1.0.0/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk-1.0.0/js/crosstalk.min.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  background-color: #f8f8f8; }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ef2929; } /* Alert */
code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #c4a000; } /* Attribute */
code span.bn { color: #0000cf; } /* BaseN */
code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4e9a06; } /* Char */
code span.cn { color: #000000; } /* Constant */
code span.co { color: #8f5902; font-style: italic; } /* Comment */
code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code span.dt { color: #204a87; } /* DataType */
code span.dv { color: #0000cf; } /* DecVal */
code span.er { color: #a40000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #0000cf; } /* Float */
code span.fu { color: #000000; } /* Function */
code span.im { } /* Import */
code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code span.ot { color: #8f5902; } /* Other */
code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code span.sc { color: #000000; } /* SpecialChar */
code span.ss { color: #4e9a06; } /* SpecialString */
code span.st { color: #4e9a06; } /* String */
code span.va { color: #000000; } /* Variable */
code span.vs { color: #4e9a06; } /* VerbatimString */
code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">KUT 計量経済学応用</a></li>
<li><a href="https://yukiyanai.github.io/" target="_blank">矢内 勇生 (Yuki Yanai)</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>はじめに</a>
<ul>
<li class="chapter" data-level="0.1" data-path="index.html"><a href="index.html#この資料について"><i class="fa fa-check"></i><b>0.1</b> この資料について</a></li>
<li class="chapter" data-level="0.2" data-path="index.html"><a href="index.html#履修条件"><i class="fa fa-check"></i><b>0.2</b> 履修条件</a></li>
<li class="chapter" data-level="0.3" data-path="index.html"><a href="index.html#r-とrstudio-のインストール"><i class="fa fa-check"></i><b>0.3</b> R とRStudio のインストール</a></li>
<li class="chapter" data-level="0.4" data-path="index.html"><a href="index.html#授業計画"><i class="fa fa-check"></i><b>0.4</b> 授業計画</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#license"><i class="fa fa-check"></i>License</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> イントロダクション</a>
<ul>
<li class="chapter" data-level="1.1" data-path="introduction.html"><a href="introduction.html#予習と講義動画の視聴"><i class="fa fa-check"></i><b>1.1</b> 予習と講義動画の視聴</a></li>
<li class="chapter" data-level="1.2" data-path="introduction.html"><a href="introduction.html#slack"><i class="fa fa-check"></i><b>1.2</b> Slack</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="introduction.html"><a href="introduction.html#slack-とは"><i class="fa fa-check"></i><b>1.2.1</b> Slack とは？</a></li>
<li class="chapter" data-level="1.2.2" data-path="introduction.html"><a href="introduction.html#授業用ワークスペースへの登録"><i class="fa fa-check"></i><b>1.2.2</b> 授業用ワークスペースへの登録</a></li>
<li class="chapter" data-level="1.2.3" data-path="introduction.html"><a href="introduction.html#利用上の注意"><i class="fa fa-check"></i><b>1.2.3</b> 利用上の注意</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="introduction.html"><a href="introduction.html#rstudio-cloud-の初期設定"><i class="fa fa-check"></i><b>1.3</b> RStudio Cloud の初期設定</a>
<ul>
<li class="chapter" data-level="1.3.1" data-path="introduction.html"><a href="introduction.html#ユーザ登録"><i class="fa fa-check"></i><b>1.3.1</b> ユーザ登録</a></li>
<li class="chapter" data-level="1.3.2" data-path="introduction.html"><a href="introduction.html#授業用のプロジェクトを作る"><i class="fa fa-check"></i><b>1.3.2</b> 授業用のプロジェクトを作る</a></li>
<li class="chapter" data-level="1.3.3" data-path="introduction.html"><a href="introduction.html#rstudio-のカスタマイズ"><i class="fa fa-check"></i><b>1.3.3</b> RStudio のカスタマイズ</a></li>
<li class="chapter" data-level="1.3.4" data-path="introduction.html"><a href="introduction.html#パッケージのインストール"><i class="fa fa-check"></i><b>1.3.4</b> パッケージのインストール</a></li>
<li class="chapter" data-level="1.3.5" data-path="introduction.html"><a href="introduction.html#ディレクトリの作成"><i class="fa fa-check"></i><b>1.3.5</b> ディレクトリの作成</a></li>
<li class="chapter" data-level="1.3.6" data-path="introduction.html"><a href="introduction.html#図で日本語が使えるようにする"><i class="fa fa-check"></i><b>1.3.6</b> 図で日本語が使えるようにする</a></li>
<li class="chapter" data-level="1.3.7" data-path="introduction.html"><a href="introduction.html#r-markdown-からpdfファイルを作る"><i class="fa fa-check"></i><b>1.3.7</b> R Markdown からPDFファイルを作る</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="introduction.html"><a href="introduction.html#トピック1の課題"><i class="fa fa-check"></i><b>1.4</b> トピック1の課題</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="selection-bias.html"><a href="selection-bias.html"><i class="fa fa-check"></i><b>2</b> セレクションバイアス</a>
<ul>
<li class="chapter" data-level="2.1" data-path="selection-bias.html"><a href="selection-bias.html#準備"><i class="fa fa-check"></i><b>2.1</b> 準備</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="selection-bias.html"><a href="selection-bias.html#予習講義動画実習課題"><i class="fa fa-check"></i><b>2.1.1</b> 予習、講義動画、実習課題</a></li>
<li class="chapter" data-level="2.1.2" data-path="selection-bias.html"><a href="selection-bias.html#rパッケージの読み込み"><i class="fa fa-check"></i><b>2.1.2</b> Rパッケージの読み込み</a></li>
<li class="chapter" data-level="2.1.3" data-path="selection-bias.html"><a href="selection-bias.html#このトピックで使うrコードの説明"><i class="fa fa-check"></i><b>2.1.3</b> このトピックで使うRコードの説明</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="selection-bias.html"><a href="selection-bias.html#セレクションバイアスのシミュレーション"><i class="fa fa-check"></i><b>2.2</b> セレクションバイアスのシミュレーション</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="selection-bias.html"><a href="selection-bias.html#メールによる販促の効果"><i class="fa fa-check"></i><b>2.2.1</b> メールによる販促の効果</a></li>
<li class="chapter" data-level="2.2.2" data-path="selection-bias.html"><a href="selection-bias.html#通院と健康状態セルフセレクション"><i class="fa fa-check"></i><b>2.2.2</b> 通院と健康状態：セルフセレクション</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="selection-bias.html"><a href="selection-bias.html#トピック2の課題"><i class="fa fa-check"></i><b>2.3</b> トピック2の課題</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="RCT.html"><a href="RCT.html"><i class="fa fa-check"></i><b>3</b> RCT（ランダム化比較試験）</a>
<ul>
<li class="chapter" data-level="3.1" data-path="RCT.html"><a href="RCT.html#準備-1"><i class="fa fa-check"></i><b>3.1</b> 準備</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="RCT.html"><a href="RCT.html#予習講義動画実習課題-1"><i class="fa fa-check"></i><b>3.1.1</b> 予習、講義動画、実習課題</a></li>
<li class="chapter" data-level="3.1.2" data-path="RCT.html"><a href="RCT.html#rパッケージの読み込み-1"><i class="fa fa-check"></i><b>3.1.2</b> Rパッケージの読み込み</a></li>
<li class="chapter" data-level="3.1.3" data-path="RCT.html"><a href="RCT.html#このトピックで使うrコードの説明-1"><i class="fa fa-check"></i><b>3.1.3</b> このトピックで使うRコードの説明</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="RCT.html"><a href="RCT.html#ランダム化のシミュレーション"><i class="fa fa-check"></i><b>3.2</b> ランダム化のシミュレーション</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="RCT.html"><a href="RCT.html#母集団の設定"><i class="fa fa-check"></i><b>3.2.1</b> 母集団の設定</a></li>
<li class="chapter" data-level="3.2.2" data-path="RCT.html"><a href="RCT.html#ベルヌーイ実験"><i class="fa fa-check"></i><b>3.2.2</b> ベルヌーイ実験</a></li>
<li class="chapter" data-level="3.2.3" data-path="RCT.html"><a href="RCT.html#完全ランダム化実験"><i class="fa fa-check"></i><b>3.2.3</b> 完全ランダム化実験</a></li>
<li class="chapter" data-level="3.2.4" data-path="RCT.html"><a href="RCT.html#ブロック別ランダム化実験"><i class="fa fa-check"></i><b>3.2.4</b> ブロック別ランダム化実験</a></li>
<li class="chapter" data-level="3.2.5" data-path="RCT.html"><a href="RCT.html#ペア毎のランダム化実験"><i class="fa fa-check"></i><b>3.2.5</b> ペア毎のランダム化実験</a></li>
<li class="chapter" data-level="3.2.6" data-path="RCT.html"><a href="RCT.html#つのrct-を比較する"><i class="fa fa-check"></i><b>3.2.6</b> 4つのRCT を比較する</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="RCT.html"><a href="RCT.html#トピック3の課題"><i class="fa fa-check"></i><b>3.3</b> トピック3の課題</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="regression.html"><a href="regression.html"><i class="fa fa-check"></i><b>4</b> 回帰分析</a>
<ul>
<li class="chapter" data-level="4.1" data-path="regression.html"><a href="regression.html#準備-2"><i class="fa fa-check"></i><b>4.1</b> 準備</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="regression.html"><a href="regression.html#予習講義動画実習課題-2"><i class="fa fa-check"></i><b>4.1.1</b> 予習、講義動画、実習課題</a></li>
<li class="chapter" data-level="4.1.2" data-path="regression.html"><a href="regression.html#rパッケージの読み込み-2"><i class="fa fa-check"></i><b>4.1.2</b> Rパッケージの読み込み</a></li>
<li class="chapter" data-level="4.1.3" data-path="regression.html"><a href="regression.html#関数の自作"><i class="fa fa-check"></i><b>4.1.3</b> 関数の自作</a></li>
<li class="chapter" data-level="4.1.4" data-path="regression.html"><a href="regression.html#このトピックで使うrコードの説明-2"><i class="fa fa-check"></i><b>4.1.4</b> このトピックで使うRコードの説明</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="regression.html"><a href="regression.html#回帰分析のシミュレーション"><i class="fa fa-check"></i><b>4.2</b> 回帰分析のシミュレーション</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="regression.html"><a href="regression.html#単回帰"><i class="fa fa-check"></i><b>4.2.1</b> 単回帰</a></li>
<li class="chapter" data-level="4.2.2" data-path="regression.html"><a href="regression.html#重回帰"><i class="fa fa-check"></i><b>4.2.2</b> 重回帰</a></li>
<li class="chapter" data-level="4.2.3" data-path="regression.html"><a href="regression.html#重回帰によるブロッキング"><i class="fa fa-check"></i><b>4.2.3</b> 重回帰によるブロッキング</a></li>
<li class="chapter" data-level="4.2.4" data-path="regression.html"><a href="regression.html#重回帰分析によるセレクションバイアスの除去"><i class="fa fa-check"></i><b>4.2.4</b> 重回帰分析によるセレクションバイアスの除去</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="regression.html"><a href="regression.html#脱落変数バイアスと処置後変数バイアス"><i class="fa fa-check"></i><b>4.3</b> 脱落変数バイアスと処置後変数バイアス</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="regression.html"><a href="regression.html#脱落変数バイアス-ovb"><i class="fa fa-check"></i><b>4.3.1</b> 脱落変数バイアス (OVB)</a></li>
<li class="chapter" data-level="4.3.2" data-path="regression.html"><a href="regression.html#処置後変数バイアス"><i class="fa fa-check"></i><b>4.3.2</b> 処置後変数バイアス</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="regression.html"><a href="regression.html#dag有向非巡回グラフ"><i class="fa fa-check"></i><b>4.4</b> DAG（有向非巡回グラフ）</a></li>
<li class="chapter" data-level="4.5" data-path="regression.html"><a href="regression.html#トピック4の課題"><i class="fa fa-check"></i><b>4.5</b> トピック4の課題</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="propensity-score.html"><a href="propensity-score.html"><i class="fa fa-check"></i><b>5</b> 傾向スコア</a>
<ul>
<li class="chapter" data-level="5.1" data-path="propensity-score.html"><a href="propensity-score.html#準備-3"><i class="fa fa-check"></i><b>5.1</b> 準備</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="propensity-score.html"><a href="propensity-score.html#予習講義動画実習課題-3"><i class="fa fa-check"></i><b>5.1.1</b> 予習、講義動画、実習課題</a></li>
<li class="chapter" data-level="5.1.2" data-path="propensity-score.html"><a href="propensity-score.html#rパッケージの読み込み-3"><i class="fa fa-check"></i><b>5.1.2</b> Rパッケージの読み込み</a></li>
<li class="chapter" data-level="5.1.3" data-path="propensity-score.html"><a href="propensity-score.html#関数の自作-1"><i class="fa fa-check"></i><b>5.1.3</b> 関数の自作</a></li>
<li class="chapter" data-level="5.1.4" data-path="propensity-score.html"><a href="propensity-score.html#このトピックで使うrコードの説明-3"><i class="fa fa-check"></i><b>5.1.4</b> このトピックで使うRコードの説明</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="propensity-score.html"><a href="propensity-score.html#傾向スコアを用いた因果推論の手順"><i class="fa fa-check"></i><b>5.2</b> 傾向スコアを用いた因果推論の手順</a></li>
<li class="chapter" data-level="5.3" data-path="propensity-score.html"><a href="propensity-score.html#共変量の選定"><i class="fa fa-check"></i><b>5.3</b> 共変量の選定</a></li>
<li class="chapter" data-level="5.4" data-path="propensity-score.html"><a href="propensity-score.html#傾向スコアの推定"><i class="fa fa-check"></i><b>5.4</b> 傾向スコアの推定</a></li>
<li class="chapter" data-level="5.5" data-path="propensity-score.html"><a href="propensity-score.html#バランス調整バランスチェック因果効果の推定"><i class="fa fa-check"></i><b>5.5</b> バランス調整、バランスチェック、因果効果の推定</a>
<ul>
<li class="chapter" data-level="5.5.1" data-path="propensity-score.html"><a href="propensity-score.html#重み付け"><i class="fa fa-check"></i><b>5.5.1</b> 重み付け</a></li>
<li class="chapter" data-level="5.5.2" data-path="propensity-score.html"><a href="propensity-score.html#層別"><i class="fa fa-check"></i><b>5.5.2</b> 層別</a></li>
</ul></li>
<li class="chapter" data-level="5.6" data-path="propensity-score.html"><a href="propensity-score.html#トピック5-の課題"><i class="fa fa-check"></i><b>5.6</b> トピック5 の課題</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="difference-in-differences.html"><a href="difference-in-differences.html"><i class="fa fa-check"></i><b>6</b> 差分の差分法</a>
<ul>
<li class="chapter" data-level="6.1" data-path="difference-in-differences.html"><a href="difference-in-differences.html#準備-4"><i class="fa fa-check"></i><b>6.1</b> 準備</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="difference-in-differences.html"><a href="difference-in-differences.html#予習講義動画実習課題-4"><i class="fa fa-check"></i><b>6.1.1</b> 予習、講義動画、実習課題</a></li>
<li class="chapter" data-level="6.1.2" data-path="difference-in-differences.html"><a href="difference-in-differences.html#rパッケージの読み込み-4"><i class="fa fa-check"></i><b>6.1.2</b> Rパッケージの読み込み</a></li>
<li class="chapter" data-level="6.1.3" data-path="difference-in-differences.html"><a href="difference-in-differences.html#このトピックで使うrコードの説明-4"><i class="fa fa-check"></i><b>6.1.3</b> このトピックで使うRコードの説明</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="difference-in-differences.html"><a href="difference-in-differences.html#最低賃金の影響"><i class="fa fa-check"></i><b>6.2</b> 最低賃金の影響</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="difference-in-differences.html"><a href="difference-in-differences.html#card-and-krueger-1994-の研究"><i class="fa fa-check"></i><b>6.2.1</b> Card and Krueger (1994) の研究</a></li>
<li class="chapter" data-level="6.2.2" data-path="difference-in-differences.html"><a href="difference-in-differences.html#処置の確認"><i class="fa fa-check"></i><b>6.2.2</b> 処置の確認</a></li>
<li class="chapter" data-level="6.2.3" data-path="difference-in-differences.html"><a href="difference-in-differences.html#単純比較-i-個体間比較"><i class="fa fa-check"></i><b>6.2.3</b> 単純比較 I： 個体間比較</a></li>
<li class="chapter" data-level="6.2.4" data-path="difference-in-differences.html"><a href="difference-in-differences.html#単純比較-ii前後比較"><i class="fa fa-check"></i><b>6.2.4</b> 単純比較 II：前後比較</a></li>
<li class="chapter" data-level="6.2.5" data-path="difference-in-differences.html"><a href="difference-in-differences.html#did"><i class="fa fa-check"></i><b>6.2.5</b> DID</a></li>
<li class="chapter" data-level="6.2.6" data-path="difference-in-differences.html"><a href="difference-in-differences.html#回帰分析によるdid-の推定"><i class="fa fa-check"></i><b>6.2.6</b> 回帰分析によるDID の推定</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="difference-in-differences.html"><a href="difference-in-differences.html#法定飲酒年齢の影響"><i class="fa fa-check"></i><b>6.3</b> 法定飲酒年齢の影響</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="difference-in-differences.html"><a href="difference-in-differences.html#angrist-and-pischke-2009-の例"><i class="fa fa-check"></i><b>6.3.1</b> Angrist and Pischke (2009) の例</a></li>
<li class="chapter" data-level="6.3.2" data-path="difference-in-differences.html"><a href="difference-in-differences.html#did-回帰"><i class="fa fa-check"></i><b>6.3.2</b> DID 回帰</a></li>
<li class="chapter" data-level="6.3.3" data-path="difference-in-differences.html"><a href="difference-in-differences.html#平行トレンドの仮定"><i class="fa fa-check"></i><b>6.3.3</b> 平行トレンドの仮定</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="difference-in-differences.html"><a href="difference-in-differences.html#シミュレーション"><i class="fa fa-check"></i><b>6.4</b> シミュレーション</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="difference-in-differences.html"><a href="difference-in-differences.html#シミュレーションの設定"><i class="fa fa-check"></i><b>6.4.1</b> シミュレーションの設定</a></li>
<li class="chapter" data-level="6.4.2" data-path="difference-in-differences.html"><a href="difference-in-differences.html#シミュレーションの繰り返し実行"><i class="fa fa-check"></i><b>6.4.2</b> シミュレーションの繰り返し実行</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="difference-in-differences.html"><a href="difference-in-differences.html#トピック6の課題"><i class="fa fa-check"></i><b>6.5</b> トピック6の課題</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="midterm-presentation.html"><a href="midterm-presentation.html"><i class="fa fa-check"></i><b>7</b> 分析計画のプレゼンテーション</a>
<ul>
<li class="chapter" data-level="7.1" data-path="midterm-presentation.html"><a href="midterm-presentation.html#このトピックでやるべきこと"><i class="fa fa-check"></i><b>7.1</b> このトピックでやるべきこと</a></li>
<li class="chapter" data-level="7.2" data-path="midterm-presentation.html"><a href="midterm-presentation.html#分析計画のプレゼンテーション-1"><i class="fa fa-check"></i><b>7.2</b> 分析計画のプレゼンテーション</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="midterm-presentation.html"><a href="midterm-presentation.html#プレゼンテーションの内容"><i class="fa fa-check"></i><b>7.2.1</b> プレゼンテーションの内容</a></li>
<li class="chapter" data-level="7.2.2" data-path="midterm-presentation.html"><a href="midterm-presentation.html#プレゼンテーションの方法"><i class="fa fa-check"></i><b>7.2.2</b> プレゼンテーションの方法</a></li>
<li class="chapter" data-level="7.2.3" data-path="midterm-presentation.html"><a href="midterm-presentation.html#プレゼンテーション動画の作成法"><i class="fa fa-check"></i><b>7.2.3</b> プレゼンテーション動画の作成法</a></li>
<li class="chapter" data-level="7.2.4" data-path="midterm-presentation.html"><a href="midterm-presentation.html#提出方法と提出期限"><i class="fa fa-check"></i><b>7.2.4</b> 提出方法と提出期限</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="midterm-presentation.html"><a href="midterm-presentation.html#他の受講生へのコメントについて"><i class="fa fa-check"></i><b>7.3</b> 他の受講生へのコメントについて</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="regression-discontinuity.html"><a href="regression-discontinuity.html"><i class="fa fa-check"></i><b>8</b> 回帰不連続デザイン</a>
<ul>
<li class="chapter" data-level="8.1" data-path="regression-discontinuity.html"><a href="regression-discontinuity.html#準備-5"><i class="fa fa-check"></i><b>8.1</b> 準備</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="regression-discontinuity.html"><a href="regression-discontinuity.html#予習講義動画実習課題-5"><i class="fa fa-check"></i><b>8.1.1</b> 予習、講義動画、実習課題</a></li>
<li class="chapter" data-level="8.1.2" data-path="regression-discontinuity.html"><a href="regression-discontinuity.html#rパッケージの読み込み-5"><i class="fa fa-check"></i><b>8.1.2</b> Rパッケージの読み込み</a></li>
<li class="chapter" data-level="8.1.3" data-path="regression-discontinuity.html"><a href="regression-discontinuity.html#このトピックで使うrコードの説明-5"><i class="fa fa-check"></i><b>8.1.3</b> このトピックで使うRコードの説明</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="regression-discontinuity.html"><a href="regression-discontinuity.html#法定飲酒年齢の影響-1"><i class="fa fa-check"></i><b>8.2</b> 法定飲酒年齢の影響</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="regression-discontinuity.html"><a href="regression-discontinuity.html#angrist-and-pischke-2009-の例-1"><i class="fa fa-check"></i><b>8.2.1</b> Angrist and Pischke (2009) の例</a></li>
<li class="chapter" data-level="8.2.2" data-path="regression-discontinuity.html"><a href="regression-discontinuity.html#パラメトリックrd"><i class="fa fa-check"></i><b>8.2.2</b> パラメトリックRD</a></li>
<li class="chapter" data-level="8.2.3" data-path="regression-discontinuity.html"><a href="regression-discontinuity.html#ノンパラメトリックrd"><i class="fa fa-check"></i><b>8.2.3</b> ノンパラメトリックRD</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="regression-discontinuity.html"><a href="regression-discontinuity.html#トピック8の課題"><i class="fa fa-check"></i><b>8.3</b> トピック8の課題</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="instrumental-variable.html"><a href="instrumental-variable.html"><i class="fa fa-check"></i><b>9</b> 操作変数法</a></li>
<li class="chapter" data-level="10" data-path="final-presentation.html"><a href="final-presentation.html"><i class="fa fa-check"></i><b>10</b> 分析結果のプレゼンテーション</a>
<ul>
<li class="chapter" data-level="10.1" data-path="final-presentation.html"><a href="final-presentation.html#このトピックでやるべきこと-1"><i class="fa fa-check"></i><b>10.1</b> このトピックでやるべきこと</a></li>
<li class="chapter" data-level="10.2" data-path="final-presentation.html"><a href="final-presentation.html#分析結果のレポート期末レポート"><i class="fa fa-check"></i><b>10.2</b> 分析結果のレポート（期末レポート）</a>
<ul>
<li class="chapter" data-level="10.2.1" data-path="final-presentation.html"><a href="final-presentation.html#レポートの内容"><i class="fa fa-check"></i><b>10.2.1</b> レポートの内容</a></li>
<li class="chapter" data-level="10.2.2" data-path="final-presentation.html"><a href="final-presentation.html#レポートの形式と提出方法"><i class="fa fa-check"></i><b>10.2.2</b> レポートの形式と提出方法</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="final-presentation.html"><a href="final-presentation.html#分析結果のプレゼンテーション-1"><i class="fa fa-check"></i><b>10.3</b> 分析結果のプレゼンテーション</a>
<ul>
<li class="chapter" data-level="10.3.1" data-path="final-presentation.html"><a href="final-presentation.html#プレゼンテーションの内容-1"><i class="fa fa-check"></i><b>10.3.1</b> プレゼンテーションの内容</a></li>
<li class="chapter" data-level="10.3.2" data-path="final-presentation.html"><a href="final-presentation.html#提出方法と提出期限-1"><i class="fa fa-check"></i><b>10.3.2</b> 提出方法と提出期限</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="appendix.html"><a href="appendix.html"><i class="fa fa-check"></i>補遺</a>
<ul>
<li class="chapter" data-level="" data-path="appendix.html"><a href="appendix.html#実行環境"><i class="fa fa-check"></i>実行環境</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>参考文献</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="_blank">Published with bookdown</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">KUT 計量経済学応用</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="rctランダム化比較試験" class="section level1" number="3">
<h1><span class="header-section-number">Topic 3</span> RCT（ランダム化比較試験）</h1>
<ul>
<li><a href="https://yukiyanai.github.io/jp/classes/econometrics2/contents/slides/metrics2_topic03_slides.pdf">トピック3の講義スライド</a> (PDF, 1.4MB)</li>
</ul>
<div id="準備-1" class="section level2" number="3.1">
<h2><span class="header-section-number">3.1</span> 準備</h2>
<div id="予習講義動画実習課題-1" class="section level3" number="3.1.1">
<h3><span class="header-section-number">3.1.1</span> 予習、講義動画、実習課題</h3>
<p>このトピックでやるべきことは、以下のとおりである。</p>
<ol style="list-style-type: decimal">
<li><a href="http://yukiyanai.github.io/jp/classes/econometrics2/docs/syllabus-applied-econometrics_2020-2Q.pdf">シラバス(PDFファイル)</a> に記載されているトピック3の予習課題を読む。</li>
<li><a href="https://lms.kochi-tech.ac.jp/course/view.php?id=793">KUTLMS (Moodle)</a> にあるトピック3の講義動画を視聴する。</li>
<li>この資料の続きを読み、Rを使った実習を行うことでRCTの理解を深める。</li>
</ol>
<ul>
<li>まず、書いてあるコードをそのまま実行する。</li>
<li>自分で数字（シミュレーションの条件）を変えて、結果がどう変わるか研究する（<strong>課題</strong>）。</li>
</ul>
<ol start="4" style="list-style-type: decimal">
<li>（おまけ：希望者のみ）Josh Angrist による以下の解説動画（英語）を視聴する。</li>
</ol>
<ul>
<li><a href="https://www.youtube.com/watch?v=eGRd8jBdNYg">Randomized Trials: The Ideal Weapon</a></li>
</ul>
<ol start="5" style="list-style-type: decimal">
<li>教科書 <span class="citation">(安井 <a href="#ref-yasui2020" role="doc-biblioref">2020</a>)</span> 第1章のRを使った分析を自分でやってみる（<strong>課題</strong>）。</li>
</ol>
</div>
<div id="rパッケージの読み込み-1" class="section level3" number="3.1.2">
<h3><span class="header-section-number">3.1.2</span> Rパッケージの読み込み</h3>
<p>必要なパッケージを読み込み、作図用の日本語フォントを設定する。</p>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb90-1"><a href="RCT.html#cb90-1"></a>pacman<span class="op">::</span><span class="kw">p_load</span>(tidyverse, patchwork)</span>
<span id="cb90-2"><a href="RCT.html#cb90-2"></a><span class="kw">theme_set</span>(<span class="kw">theme_gray</span>(<span class="dt">base_size =</span> <span class="dv">10</span>, <span class="dt">base_family =</span> <span class="st">&quot;HiraginoSans-W3&quot;</span>))  <span class="co"># macOS用</span></span>
<span id="cb90-3"><a href="RCT.html#cb90-3"></a><span class="co">#theme_set(theme_gray(base_size = 10, base_family = &quot;Meiryo&quot;))        # Windows用</span></span>
<span id="cb90-4"><a href="RCT.html#cb90-4"></a><span class="co">#theme_set(theme_gray(base_size = 10, base_family = &quot;IPAGothic&quot;))     # Ubuntu用</span></span>
<span id="cb90-5"><a href="RCT.html#cb90-5"></a><span class="co">#showtext::showtext_auto()                                            # Cloud用</span></span>
<span id="cb90-6"><a href="RCT.html#cb90-6"></a><span class="co">#theme_set(theme_gray(base_size = 10, base_family = &quot;noto&quot;))          # Cloud用</span></span></code></pre></div>
</div>
<div id="このトピックで使うrコードの説明-1" class="section level3" number="3.1.3">
<h3><span class="header-section-number">3.1.3</span> このトピックで使うRコードの説明</h3>
<p>このトピックでは新しい関数は使わない。
理解できないコードがあれば、遠慮なくSlack で質問を。</p>
</div>
</div>
<div id="ランダム化のシミュレーション" class="section level2" number="3.2">
<h2><span class="header-section-number">3.2</span> ランダム化のシミュレーション</h2>
<div id="母集団の設定" class="section level3" number="3.2.1">
<h3><span class="header-section-number">3.2.1</span> 母集団の設定</h3>
<p>ある処置 <span class="math inline">\(D\)</span> の平均処置効果が正であると仮定して、母集団のデータを作る。
共変量として二値の性別と、年齢（20歳から65歳）を考える。</p>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb91-1"><a href="RCT.html#cb91-1"></a><span class="kw">set.seed</span>(<span class="dv">2020-06-09</span>)</span>
<span id="cb91-2"><a href="RCT.html#cb91-2"></a>N &lt;-<span class="st"> </span><span class="fl">1e6</span></span>
<span id="cb91-3"><a href="RCT.html#cb91-3"></a>y_<span class="dv">1</span>_m &lt;-<span class="st"> </span><span class="kw">rnorm</span>(N, <span class="dt">mean =</span> <span class="dv">10</span>, <span class="dt">sd =</span> <span class="dv">4</span>)</span>
<span id="cb91-4"><a href="RCT.html#cb91-4"></a>y_<span class="dv">1</span>_f &lt;-<span class="st"> </span><span class="kw">rnorm</span>(N, <span class="dt">mean =</span> <span class="dv">12</span>, <span class="dt">sd =</span> <span class="dv">4</span>)</span>
<span id="cb91-5"><a href="RCT.html#cb91-5"></a>y_<span class="dv">0</span>_m &lt;-<span class="st"> </span><span class="kw">rnorm</span>(N, <span class="dt">mean =</span> <span class="dv">0</span>, <span class="dt">sd =</span> <span class="dv">2</span>)</span>
<span id="cb91-6"><a href="RCT.html#cb91-6"></a>y_<span class="dv">0</span>_f &lt;-<span class="st"> </span><span class="kw">rnorm</span>(N, <span class="dt">mean =</span> <span class="dv">4</span>, <span class="dt">sd =</span> <span class="dv">2</span>)</span>
<span id="cb91-7"><a href="RCT.html#cb91-7"></a>age &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="dv">20</span><span class="op">:</span><span class="dv">65</span>, <span class="dt">size =</span> N, <span class="dt">replace =</span> <span class="ot">TRUE</span>)</span>
<span id="cb91-8"><a href="RCT.html#cb91-8"></a>df_pop &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">id =</span> <span class="dv">1</span><span class="op">:</span>N,</span>
<span id="cb91-9"><a href="RCT.html#cb91-9"></a>                 <span class="dt">age =</span> age) <span class="op">%&gt;%</span></span>
<span id="cb91-10"><a href="RCT.html#cb91-10"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">male =</span> <span class="kw">rbinom</span>(<span class="kw">n</span>(), <span class="dt">size =</span> <span class="dv">1</span>, <span class="dt">prob =</span> <span class="fl">0.5</span>),</span>
<span id="cb91-11"><a href="RCT.html#cb91-11"></a>           <span class="dt">y_1  =</span> <span class="kw">ifelse</span>(male, y_<span class="dv">1</span>_m, y_<span class="dv">1</span>_f) <span class="op">+</span><span class="st"> </span><span class="fl">0.05</span> <span class="op">*</span><span class="st"> </span>(age <span class="op">-</span><span class="st"> </span><span class="kw">mean</span>(age)),</span>
<span id="cb91-12"><a href="RCT.html#cb91-12"></a>           <span class="dt">y_0  =</span> <span class="kw">ifelse</span>(male, y_<span class="dv">0</span>_m, y_<span class="dv">0</span>_f) <span class="op">+</span><span class="st"> </span><span class="fl">0.05</span> <span class="op">*</span><span class="st"> </span>(age <span class="op">-</span><span class="st"> </span><span class="kw">mean</span>(age)),</span>
<span id="cb91-13"><a href="RCT.html#cb91-13"></a>           <span class="dt">ITE =</span> y_<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>y_<span class="dv">0</span>)</span></code></pre></div>
<p>作成した母集団の特徴を確認する。</p>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb92-1"><a href="RCT.html#cb92-1"></a><span class="kw">summary</span>(df_pop)</span></code></pre></div>
<pre><code>##        id               age             male             y_1        
##  Min.   :      1   Min.   :20.00   Min.   :0.0000   Min.   :-9.407  
##  1st Qu.: 250001   1st Qu.:31.00   1st Qu.:0.0000   1st Qu.: 8.176  
##  Median : 500000   Median :42.00   Median :1.0000   Median :10.999  
##  Mean   : 500000   Mean   :42.48   Mean   :0.5003   Mean   :10.999  
##  3rd Qu.: 750000   3rd Qu.:54.00   3rd Qu.:1.0000   3rd Qu.:13.823  
##  Max.   :1000000   Max.   :65.00   Max.   :1.0000   Max.   :31.507  
##       y_0                ITE         
##  Min.   :-10.5585   Min.   :-12.437  
##  1st Qu.: -0.1295   1st Qu.:  5.901  
##  Median :  1.9970   Median :  9.008  
##  Mean   :  1.9990   Mean   :  9.000  
##  3rd Qu.:  4.1286   3rd Qu.: 12.092  
##  Max.   : 13.3120   Max.   : 31.514</code></pre>
<p>ITE（個体の処置効果）の分布を確認しておこう。</p>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb94-1"><a href="RCT.html#cb94-1"></a>pop_ite &lt;-<span class="st"> </span><span class="kw">ggplot</span>(df_pop, <span class="kw">aes</span>(<span class="dt">x =</span> ITE), <span class="kw">after_stat</span>(density)) <span class="op">+</span></span>
<span id="cb94-2"><a href="RCT.html#cb94-2"></a><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">color =</span> <span class="st">&quot;black&quot;</span>) <span class="op">+</span></span>
<span id="cb94-3"><a href="RCT.html#cb94-3"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">y =</span> <span class="st">&quot;確率密度&quot;</span>, <span class="dt">title =</span> <span class="st">&quot;母集団における処置効果&quot;</span>)</span>
<span id="cb94-4"><a href="RCT.html#cb94-4"></a><span class="kw">plot</span>(pop_ite)</span></code></pre></div>
<p><img src="kut-metrics2_files/figure-html/unnamed-chunk-69-1.png" width="384" /></p>
<p>平均処置効果を計算しておこう。</p>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb95-1"><a href="RCT.html#cb95-1"></a><span class="co">## 平均処置効果</span></span>
<span id="cb95-2"><a href="RCT.html#cb95-2"></a>pop_ATE &lt;-<span class="st"> </span><span class="kw">mean</span>(df_pop<span class="op">$</span>ITE) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">print</span>()      </span></code></pre></div>
<pre><code>## [1] 8.999995</code></pre>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb97-1"><a href="RCT.html#cb97-1"></a><span class="co">## 男性における平均処置効果</span></span>
<span id="cb97-2"><a href="RCT.html#cb97-2"></a>pop_ATE_m &lt;-<span class="st"> </span>df_pop <span class="op">%&gt;%</span><span class="st">     </span></span>
<span id="cb97-3"><a href="RCT.html#cb97-3"></a><span class="st">  </span><span class="kw">filter</span>(male <span class="op">==</span><span class="st"> </span><span class="dv">1</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb97-4"><a href="RCT.html#cb97-4"></a><span class="st">  </span><span class="kw">with</span>(<span class="kw">mean</span>(ITE)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb97-5"><a href="RCT.html#cb97-5"></a><span class="st">  </span><span class="kw">print</span>()</span></code></pre></div>
<pre><code>## [1] 9.993789</code></pre>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb99-1"><a href="RCT.html#cb99-1"></a><span class="co">## 女性における平均処置効果</span></span>
<span id="cb99-2"><a href="RCT.html#cb99-2"></a>pop_ATE_f &lt;-<span class="st"> </span>df_pop <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb99-3"><a href="RCT.html#cb99-3"></a><span class="st">  </span><span class="kw">filter</span>(male <span class="op">==</span><span class="st"> </span><span class="dv">0</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb99-4"><a href="RCT.html#cb99-4"></a><span class="st">  </span><span class="kw">with</span>(<span class="kw">mean</span>(ITE)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb99-5"><a href="RCT.html#cb99-5"></a><span class="st">  </span><span class="kw">print</span>()</span></code></pre></div>
<pre><code>## [1] 8.005113</code></pre>
<p>以下では、この母集団に対して異なる方法でRCTを実施した場合にどのような結果が得られるか、シミュレーションで確かめよう。</p>
</div>
<div id="ベルヌーイ実験" class="section level3" number="3.2.2">
<h3><span class="header-section-number">3.2.2</span> ベルヌーイ実験</h3>
<p>ベルヌーイ実験 (Bernoulli experiments) をRで実行しよう。まず、シミュレーションを繰り返し行うために、実験を実行する関数を作る。標本サイズ（1回の実験における被験者数） を <code>sample_size</code> で、各ベルヌーイ試行で処置に割付ける確率を <code>prob</code> で指定できるようにする。</p>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb101-1"><a href="RCT.html#cb101-1"></a>bern_experiment &lt;-<span class="st"> </span><span class="cf">function</span>(population, <span class="dt">sample_size =</span> <span class="dv">100</span>,</span>
<span id="cb101-2"><a href="RCT.html#cb101-2"></a>                            <span class="dt">prob =</span> <span class="fl">0.5</span>, <span class="dt">info =</span> <span class="ot">FALSE</span>) {</span>
<span id="cb101-3"><a href="RCT.html#cb101-3"></a>  df &lt;-<span class="st"> </span><span class="kw">slice_sample</span>(<span class="dt">.data =</span> population, <span class="dt">n =</span> sample_size)</span>
<span id="cb101-4"><a href="RCT.html#cb101-4"></a>  df &lt;-<span class="st"> </span>df <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb101-5"><a href="RCT.html#cb101-5"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">D =</span> <span class="kw">rbinom</span>(<span class="kw">n</span>(), <span class="dt">size =</span> <span class="dv">1</span>, <span class="dt">prob =</span> prob))</span>
<span id="cb101-6"><a href="RCT.html#cb101-6"></a>  ATE &lt;-<span class="st"> </span><span class="kw">with</span>(df, <span class="kw">mean</span>(y_<span class="dv">1</span>[D <span class="op">==</span><span class="st"> </span><span class="dv">1</span>]) <span class="op">-</span><span class="st"> </span><span class="kw">mean</span>(y_<span class="dv">0</span>[D <span class="op">==</span><span class="st"> </span><span class="dv">0</span>]))</span>
<span id="cb101-7"><a href="RCT.html#cb101-7"></a>  <span class="cf">if</span> (info) <span class="kw">cat</span>(<span class="st">&#39;処置群の個体数:&#39;</span>, <span class="kw">sum</span>(df<span class="op">$</span>D), <span class="st">&#39;; 統制群の個体数:&#39;</span>, sample_size <span class="op">-</span><span class="st"> </span><span class="kw">sum</span>(df<span class="op">$</span>D), <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)</span>
<span id="cb101-8"><a href="RCT.html#cb101-8"></a>  <span class="kw">return</span>(ATE)</span>
<span id="cb101-9"><a href="RCT.html#cb101-9"></a>}</span></code></pre></div>
<p>この関数を使ってベルヌーイ実験を1度実行してみる。<code>sample_size = 100</code>、<code>prob = 0.5</code> とする（既定値なので指定しなくて良い）。</p>
<div class="sourceCode" id="cb102"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb102-1"><a href="RCT.html#cb102-1"></a><span class="kw">bern_experiment</span>(<span class="dt">population =</span> df_pop, <span class="dt">info =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<pre><code>## 処置群の個体数: 57 ; 統制群の個体数: 43</code></pre>
<pre><code>## [1] 8.538327</code></pre>
<p>もう1回やってみる。</p>
<div class="sourceCode" id="cb105"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb105-1"><a href="RCT.html#cb105-1"></a><span class="kw">bern_experiment</span>(<span class="dt">population =</span> df_pop, <span class="dt">info =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<pre><code>## 処置群の個体数: 48 ; 統制群の個体数: 52</code></pre>
<pre><code>## [1] 9.082204</code></pre>
<p>もう1回やってみる。</p>
<div class="sourceCode" id="cb108"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb108-1"><a href="RCT.html#cb108-1"></a><span class="kw">bern_experiment</span>(<span class="dt">population =</span> df_pop, <span class="dt">info =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<pre><code>## 処置群の個体数: 47 ; 統制群の個体数: 53</code></pre>
<pre><code>## [1] 8.429646</code></pre>
<p>当然ながら、実験結果は毎回変わる。</p>
<p>実験を1000回繰り返し、結果を図示してみよう。母集団における本当の平均因果効果を赤い縦線で示す。
標本サイズは100である。</p>
<div class="sourceCode" id="cb111"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb111-1"><a href="RCT.html#cb111-1"></a>bern_<span class="dv">100</span> &lt;-<span class="st"> </span><span class="kw">replicate</span>(<span class="dv">1000</span>, <span class="kw">bern_experiment</span>(df_pop))</span>
<span id="cb111-2"><a href="RCT.html#cb111-2"></a>hist_bern_<span class="dv">100</span> &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">ATE =</span> bern_<span class="dv">100</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb111-3"><a href="RCT.html#cb111-3"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> ATE)) <span class="op">+</span></span>
<span id="cb111-4"><a href="RCT.html#cb111-4"></a><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">binwidth =</span> <span class="fl">0.2</span>, <span class="dt">color =</span> <span class="st">&quot;black&quot;</span>) <span class="op">+</span></span>
<span id="cb111-5"><a href="RCT.html#cb111-5"></a><span class="st">  </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> pop_ATE, <span class="dt">color =</span> <span class="st">&quot;tomato&quot;</span>) <span class="op">+</span></span>
<span id="cb111-6"><a href="RCT.html#cb111-6"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">y =</span> <span class="st">&quot;度数&quot;</span>, <span class="dt">title =</span> <span class="st">&quot;ベルヌーイ実験&quot;</span>)</span>
<span id="cb111-7"><a href="RCT.html#cb111-7"></a><span class="kw">plot</span>(hist_bern_<span class="dv">100</span>)</span></code></pre></div>
<p><img src="kut-metrics2_files/figure-html/unnamed-chunk-74-1.png" width="384" /></p>
<p>1つひとつの実験は必ずしも ATE を正確に推定しているわけではないが、平均すれば正しい効果を推定できていることがわかる。「正しい」ATEが9 であるのに対し、RCT による推定の平均値は 9 である。</p>
<p>処置に割付ける確率は、0.5 でなくても良い。</p>
<div class="sourceCode" id="cb112"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb112-1"><a href="RCT.html#cb112-1"></a><span class="kw">bern_experiment</span>(<span class="dt">population =</span> df_pop, <span class="dt">prob =</span> <span class="fl">0.8</span>, <span class="dt">info =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<pre><code>## 処置群の個体数: 78 ; 統制群の個体数: 22</code></pre>
<pre><code>## [1] 9.000707</code></pre>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb115-1"><a href="RCT.html#cb115-1"></a><span class="kw">bern_experiment</span>(<span class="dt">population =</span> df_pop, <span class="dt">prob =</span> <span class="fl">0.2</span>, <span class="dt">info =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<pre><code>## 処置群の個体数: 18 ; 統制群の個体数: 82</code></pre>
<pre><code>## [1] 7.948835</code></pre>
<div class="sourceCode" id="cb118"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb118-1"><a href="RCT.html#cb118-1"></a><span class="kw">bern_experiment</span>(<span class="dt">population =</span> df_pop, <span class="dt">prob =</span> <span class="fl">0.1</span>, <span class="dt">info =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<pre><code>## 処置群の個体数: 10 ; 統制群の個体数: 90</code></pre>
<pre><code>## [1] 7.335998</code></pre>
<div class="sourceCode" id="cb121"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb121-1"><a href="RCT.html#cb121-1"></a>bern_p80 &lt;-<span class="st"> </span><span class="kw">replicate</span>(<span class="dv">1000</span>, <span class="kw">bern_experiment</span>(df_pop, <span class="dt">prob =</span> <span class="fl">0.8</span>))</span>
<span id="cb121-2"><a href="RCT.html#cb121-2"></a>hist_bern_p80 &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">ATE =</span> bern_p80) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb121-3"><a href="RCT.html#cb121-3"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> ATE)) <span class="op">+</span></span>
<span id="cb121-4"><a href="RCT.html#cb121-4"></a><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">binwidth =</span> <span class="fl">0.2</span>, <span class="dt">color =</span> <span class="st">&quot;black&quot;</span>) <span class="op">+</span></span>
<span id="cb121-5"><a href="RCT.html#cb121-5"></a><span class="st">  </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> pop_ATE, <span class="dt">color =</span> <span class="st">&quot;tomato&quot;</span>) <span class="op">+</span></span>
<span id="cb121-6"><a href="RCT.html#cb121-6"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">y =</span> <span class="st">&quot;度数&quot;</span>)</span>
<span id="cb121-7"><a href="RCT.html#cb121-7"></a><span class="kw">plot</span>(hist_bern_p80)</span></code></pre></div>
<p><img src="kut-metrics2_files/figure-html/unnamed-chunk-76-1.png" width="384" /></p>
<p>標本サイズ（被験者の数）を変えるとどうなるだろうか。
標本サイズが30の場合：</p>
<div class="sourceCode" id="cb122"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb122-1"><a href="RCT.html#cb122-1"></a>bern_<span class="dv">30</span> &lt;-<span class="st"> </span><span class="kw">replicate</span>(<span class="dv">1000</span>, <span class="kw">bern_experiment</span>(df_pop, <span class="dt">sample_size =</span> <span class="dv">30</span>))</span>
<span id="cb122-2"><a href="RCT.html#cb122-2"></a>hist_bern_<span class="dv">30</span> &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">ATE =</span> bern_<span class="dv">30</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb122-3"><a href="RCT.html#cb122-3"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> ATE)) <span class="op">+</span></span>
<span id="cb122-4"><a href="RCT.html#cb122-4"></a><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">binwidth =</span> <span class="fl">0.2</span>, <span class="dt">color =</span> <span class="st">&quot;black&quot;</span>) <span class="op">+</span></span>
<span id="cb122-5"><a href="RCT.html#cb122-5"></a><span class="st">  </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> pop_ATE, <span class="dt">color =</span> <span class="st">&quot;tomato&quot;</span>) <span class="op">+</span></span>
<span id="cb122-6"><a href="RCT.html#cb122-6"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">y =</span> <span class="st">&quot;度数&quot;</span>)</span>
<span id="cb122-7"><a href="RCT.html#cb122-7"></a><span class="kw">plot</span>(hist_bern_<span class="dv">30</span>)</span></code></pre></div>
<p><img src="kut-metrics2_files/figure-html/unnamed-chunk-77-1.png" width="384" /></p>
<p>標本サイズが50の場合：</p>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb123-1"><a href="RCT.html#cb123-1"></a>bern_<span class="dv">50</span> &lt;-<span class="st"> </span><span class="kw">replicate</span>(<span class="dv">1000</span>, <span class="kw">bern_experiment</span>(df_pop, <span class="dt">sample_size =</span> <span class="dv">50</span>))</span>
<span id="cb123-2"><a href="RCT.html#cb123-2"></a>hist_bern_<span class="dv">50</span> &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">ATE =</span> bern_<span class="dv">50</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb123-3"><a href="RCT.html#cb123-3"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> ATE)) <span class="op">+</span></span>
<span id="cb123-4"><a href="RCT.html#cb123-4"></a><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">binwidth =</span> <span class="fl">0.2</span>, <span class="dt">color =</span> <span class="st">&quot;black&quot;</span>) <span class="op">+</span></span>
<span id="cb123-5"><a href="RCT.html#cb123-5"></a><span class="st">  </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> pop_ATE, <span class="dt">color =</span> <span class="st">&quot;tomato&quot;</span>) <span class="op">+</span></span>
<span id="cb123-6"><a href="RCT.html#cb123-6"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">y =</span> <span class="st">&quot;度数&quot;</span>)</span>
<span id="cb123-7"><a href="RCT.html#cb123-7"></a><span class="kw">plot</span>(hist_bern_<span class="dv">50</span>)</span></code></pre></div>
<p><img src="kut-metrics2_files/figure-html/unnamed-chunk-78-1.png" width="384" /></p>
<p>標本サイズが500の場合：</p>
<div class="sourceCode" id="cb124"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb124-1"><a href="RCT.html#cb124-1"></a>bern_<span class="dv">500</span> &lt;-<span class="st"> </span><span class="kw">replicate</span>(<span class="dv">1000</span>, <span class="kw">bern_experiment</span>(df_pop, <span class="dt">sample_size =</span> <span class="dv">500</span>))</span>
<span id="cb124-2"><a href="RCT.html#cb124-2"></a>hist_bern_<span class="dv">500</span> &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">ATE =</span> bern_<span class="dv">500</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb124-3"><a href="RCT.html#cb124-3"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> ATE)) <span class="op">+</span></span>
<span id="cb124-4"><a href="RCT.html#cb124-4"></a><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">binwidth =</span> <span class="fl">0.2</span>, <span class="dt">color =</span> <span class="st">&quot;black&quot;</span>) <span class="op">+</span></span>
<span id="cb124-5"><a href="RCT.html#cb124-5"></a><span class="st">  </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> pop_ATE, <span class="dt">color =</span> <span class="st">&quot;tomato&quot;</span>) <span class="op">+</span></span>
<span id="cb124-6"><a href="RCT.html#cb124-6"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">y =</span> <span class="st">&quot;度数&quot;</span>)</span>
<span id="cb124-7"><a href="RCT.html#cb124-7"></a><span class="kw">plot</span>(hist_bern_<span class="dv">500</span>)</span></code></pre></div>
<p><img src="kut-metrics2_files/figure-html/unnamed-chunk-79-1.png" width="384" /></p>
<p>標本サイズが小さくても、平均的には正しい因果効果を推定できている。
しかし、標本サイズが小さいと、推定のばらつき（標準誤差）が大きくなる。</p>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb125-1"><a href="RCT.html#cb125-1"></a><span class="kw">sd</span>(bern_<span class="dv">30</span>)</span></code></pre></div>
<pre><code>## [1] 1.303407</code></pre>
<div class="sourceCode" id="cb127"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb127-1"><a href="RCT.html#cb127-1"></a><span class="kw">sd</span>(bern_<span class="dv">50</span>)</span></code></pre></div>
<pre><code>## [1] 1.004959</code></pre>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb129-1"><a href="RCT.html#cb129-1"></a><span class="kw">sd</span>(bern_<span class="dv">100</span>)</span></code></pre></div>
<pre><code>## [1] 0.7140102</code></pre>
<div class="sourceCode" id="cb131"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb131-1"><a href="RCT.html#cb131-1"></a><span class="kw">sd</span>(bern_<span class="dv">500</span>)</span></code></pre></div>
<pre><code>## [1] 0.330548</code></pre>
<p>標準誤差が大きいと、過小推定や過大推定が多くなることがわかる。実験を1回（2回、3回）しか行わないなら、標本サイズを十分な大きさにしないと、過小推定や過大推定をしてしまうかもしれない。</p>
</div>
<div id="完全ランダム化実験" class="section level3" number="3.2.3">
<h3><span class="header-section-number">3.2.3</span> 完全ランダム化実験</h3>
<p>次に、完全ランダム化実験 (completely random experiments) を行う。
<code>sample_size</code> と、処置に割付ける個体の数 <code>n_treated</code> を選べるようにする。ただし、<code>sample_size &gt; n_treated</code> である。</p>
<div class="sourceCode" id="cb133"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb133-1"><a href="RCT.html#cb133-1"></a>cr_experiment &lt;-<span class="st"> </span><span class="cf">function</span>(population, <span class="dt">sample_size =</span> <span class="dv">100</span>,</span>
<span id="cb133-2"><a href="RCT.html#cb133-2"></a>                          <span class="dt">n_treated =</span> <span class="kw">ceiling</span>(sample_size <span class="op">/</span><span class="st"> </span><span class="dv">2</span>), <span class="dt">info =</span> <span class="ot">FALSE</span>) {</span>
<span id="cb133-3"><a href="RCT.html#cb133-3"></a>  <span class="cf">if</span> (sample_size <span class="op">&lt;=</span><span class="st"> </span>n_treated <span class="op">|</span><span class="st"> </span>n_treated <span class="op">&lt;=</span><span class="st"> </span><span class="dv">0</span>) </span>
<span id="cb133-4"><a href="RCT.html#cb133-4"></a>    <span class="kw">stop</span>(<span class="st">&#39;n_treated must be a positive integer smaller than sample_size.&#39;</span>)</span>
<span id="cb133-5"><a href="RCT.html#cb133-5"></a>  df &lt;-<span class="st"> </span><span class="kw">slice_sample</span>(<span class="dt">.data =</span> population, <span class="dt">n =</span> sample_size) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb133-6"><a href="RCT.html#cb133-6"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">D =</span> <span class="kw">sample</span>(<span class="kw">rep</span>(<span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">0</span>), <span class="kw">c</span>(n_treated, sample_size <span class="op">-</span><span class="st"> </span>n_treated)),</span>
<span id="cb133-7"><a href="RCT.html#cb133-7"></a>                      <span class="dt">size =</span> sample_size, <span class="dt">replace =</span> <span class="ot">FALSE</span>))</span>
<span id="cb133-8"><a href="RCT.html#cb133-8"></a>  ATE &lt;-<span class="st"> </span><span class="kw">with</span>(df, <span class="kw">mean</span>(y_<span class="dv">1</span>[D <span class="op">==</span><span class="st"> </span><span class="dv">1</span>]) <span class="op">-</span><span class="st"> </span><span class="kw">mean</span>(y_<span class="dv">0</span>[D <span class="op">==</span><span class="st"> </span><span class="dv">0</span>]))</span>
<span id="cb133-9"><a href="RCT.html#cb133-9"></a>  <span class="cf">if</span> (info) <span class="kw">cat</span>(<span class="st">&#39;処置群の個体数:&#39;</span>, n_treated, <span class="st">&#39;; 統制群の個体数:&#39;</span>, sample_size <span class="op">-</span><span class="st"> </span>n_treated, <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)</span>
<span id="cb133-10"><a href="RCT.html#cb133-10"></a>  <span class="kw">return</span>(ATE)</span>
<span id="cb133-11"><a href="RCT.html#cb133-11"></a>}</span></code></pre></div>
<p><code>sample_size = 100</code>、<code>n_treatd = 50</code> （どちらも既定値）にして、1回実験を行ってみよう。</p>
<div class="sourceCode" id="cb134"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb134-1"><a href="RCT.html#cb134-1"></a><span class="kw">cr_experiment</span>(df_pop, <span class="dt">info =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<pre><code>## 処置群の個体数: 50 ; 統制群の個体数: 50</code></pre>
<pre><code>## [1] 8.584128</code></pre>
<p>もう1度やってみる。</p>
<div class="sourceCode" id="cb137"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb137-1"><a href="RCT.html#cb137-1"></a><span class="kw">cr_experiment</span>(df_pop, <span class="dt">info =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<pre><code>## 処置群の個体数: 50 ; 統制群の個体数: 50</code></pre>
<pre><code>## [1] 9.89403</code></pre>
<p>この実験を1000回繰り返し、結果を可視化しよう。</p>
<div class="sourceCode" id="cb140"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb140-1"><a href="RCT.html#cb140-1"></a>cr_<span class="dv">100</span> &lt;-<span class="st"> </span><span class="kw">replicate</span>(<span class="dv">1000</span>, <span class="kw">cr_experiment</span>(df_pop))</span>
<span id="cb140-2"><a href="RCT.html#cb140-2"></a>hist_cr_<span class="dv">100</span> &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">ATE =</span> cr_<span class="dv">100</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb140-3"><a href="RCT.html#cb140-3"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> ATE)) <span class="op">+</span></span>
<span id="cb140-4"><a href="RCT.html#cb140-4"></a><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">binwidth =</span> <span class="fl">0.2</span>, <span class="dt">color =</span> <span class="st">&quot;black&quot;</span>) <span class="op">+</span></span>
<span id="cb140-5"><a href="RCT.html#cb140-5"></a><span class="st">  </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> pop_ATE, <span class="dt">color =</span> <span class="st">&quot;tomato&quot;</span>) <span class="op">+</span></span>
<span id="cb140-6"><a href="RCT.html#cb140-6"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">y =</span> <span class="st">&quot;度数&quot;</span>, <span class="dt">title =</span> <span class="st">&quot;完全ランダム化実験&quot;</span>)</span>
<span id="cb140-7"><a href="RCT.html#cb140-7"></a><span class="kw">plot</span>(hist_cr_<span class="dv">100</span>)</span></code></pre></div>
<p><img src="kut-metrics2_files/figure-html/unnamed-chunk-84-1.png" width="384" /></p>
<p>やはり、平均的にはうまく推定できているようだ。ATEの推定値の平均値は、9 である。</p>
<p>完全ランダム化実験で処置に割付ける数は、標本サイズの半分でなくても良い。</p>
<div class="sourceCode" id="cb141"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb141-1"><a href="RCT.html#cb141-1"></a><span class="kw">cr_experiment</span>(df_pop, <span class="dt">sample_size =</span> <span class="dv">100</span>, <span class="dt">n_treated =</span> <span class="dv">70</span>, <span class="dt">info =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<pre><code>## 処置群の個体数: 70 ; 統制群の個体数: 30</code></pre>
<pre><code>## [1] 7.992297</code></pre>
<div class="sourceCode" id="cb144"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb144-1"><a href="RCT.html#cb144-1"></a><span class="kw">cr_experiment</span>(df_pop, <span class="dt">sample_size =</span> <span class="dv">100</span>, <span class="dt">n_treated =</span> <span class="dv">25</span>, <span class="dt">info =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<pre><code>## 処置群の個体数: 25 ; 統制群の個体数: 75</code></pre>
<pre><code>## [1] 9.782785</code></pre>
<p>この実験を1000回繰り返し、結果を可視化しよう。</p>
<div class="sourceCode" id="cb147"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb147-1"><a href="RCT.html#cb147-1"></a>cr_prop20 &lt;-<span class="st"> </span><span class="kw">replicate</span>(<span class="dv">1000</span>, <span class="kw">cr_experiment</span>(df_pop, <span class="dt">sample_size =</span> <span class="dv">100</span>, <span class="dt">n_treated =</span> <span class="dv">20</span>))</span>
<span id="cb147-2"><a href="RCT.html#cb147-2"></a>hist_cr_prop20 &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">ATE =</span> cr_prop20) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb147-3"><a href="RCT.html#cb147-3"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> ATE)) <span class="op">+</span></span>
<span id="cb147-4"><a href="RCT.html#cb147-4"></a><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">binwidth =</span> <span class="fl">0.2</span>, <span class="dt">color =</span> <span class="st">&quot;black&quot;</span>) <span class="op">+</span></span>
<span id="cb147-5"><a href="RCT.html#cb147-5"></a><span class="st">  </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> pop_ATE, <span class="dt">color =</span> <span class="st">&quot;tomato&quot;</span>) <span class="op">+</span></span>
<span id="cb147-6"><a href="RCT.html#cb147-6"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">y =</span> <span class="st">&quot;度数&quot;</span>)</span>
<span id="cb147-7"><a href="RCT.html#cb147-7"></a><span class="kw">plot</span>(hist_cr_prop20)</span></code></pre></div>
<p><img src="kut-metrics2_files/figure-html/unnamed-chunk-87-1.png" width="384" /></p>
<p>標本サイズ（被験者数）の20％のみを処置に割付けても、平均的には正しいATEを推定できる。</p>
</div>
<div id="ブロック別ランダム化実験" class="section level3" number="3.2.4">
<h3><span class="header-section-number">3.2.4</span> ブロック別ランダム化実験</h3>
<p>続いて、ブロック別ランダム化実験 (stratified randomized experiments) を実施してみよう。
ここでは、性別（男性ダミー変数）によってブロックを作る。
処置に割付ける数は、各群における処置の割合で指定できるようにする。
例えば、男性ブロックでは7割を処置、女性ブロックでは4割を処置するなら、<code>prop = c(0.7, 0.4)</code> と指定できるようにする。</p>
<div class="sourceCode" id="cb148"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb148-1"><a href="RCT.html#cb148-1"></a>strat_experiment &lt;-<span class="st"> </span><span class="cf">function</span>(population, <span class="dt">sample_size =</span> <span class="dv">100</span>,</span>
<span id="cb148-2"><a href="RCT.html#cb148-2"></a>                             <span class="dt">prop =</span> <span class="kw">c</span>(<span class="fl">0.5</span>, <span class="fl">0.5</span>), <span class="dt">info =</span> <span class="ot">FALSE</span>) {</span>
<span id="cb148-3"><a href="RCT.html#cb148-3"></a>  </span>
<span id="cb148-4"><a href="RCT.html#cb148-4"></a>  <span class="cf">if</span> (<span class="kw">min</span>(prop) <span class="op">&lt;=</span><span class="st"> </span><span class="dv">0</span> <span class="op">|</span><span class="st"> </span><span class="kw">max</span>(prop) <span class="op">&gt;=</span><span class="st"> </span><span class="dv">1</span>) <span class="kw">stop</span>(<span class="st">&quot;prop must be in (0, 1).&quot;</span>)</span>
<span id="cb148-5"><a href="RCT.html#cb148-5"></a>  </span>
<span id="cb148-6"><a href="RCT.html#cb148-6"></a>  df &lt;-<span class="st"> </span><span class="kw">slice_sample</span>(<span class="dt">.data =</span> population, <span class="dt">n =</span> sample_size)</span>
<span id="cb148-7"><a href="RCT.html#cb148-7"></a>  Male &lt;-<span class="st"> </span>df <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(male <span class="op">==</span><span class="st"> </span><span class="dv">1</span>)</span>
<span id="cb148-8"><a href="RCT.html#cb148-8"></a>  Female &lt;-<span class="st"> </span>df <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(male <span class="op">==</span><span class="st"> </span><span class="dv">0</span>)</span>
<span id="cb148-9"><a href="RCT.html#cb148-9"></a>  n_treated &lt;-<span class="st"> </span><span class="kw">ceiling</span>(<span class="kw">c</span>(<span class="kw">nrow</span>(Male), <span class="kw">nrow</span>(Female)) <span class="op">*</span><span class="st"> </span>prop)</span>
<span id="cb148-10"><a href="RCT.html#cb148-10"></a>  ATE_male &lt;-<span class="st"> </span><span class="kw">cr_experiment</span>(Male, <span class="dt">sample_size =</span> <span class="kw">nrow</span>(Male),</span>
<span id="cb148-11"><a href="RCT.html#cb148-11"></a>                            <span class="dt">n_treated =</span> n_treated[<span class="dv">1</span>])</span>
<span id="cb148-12"><a href="RCT.html#cb148-12"></a>  ATE_female &lt;-<span class="st"> </span><span class="kw">cr_experiment</span>(Female, <span class="dt">sample_size =</span> <span class="kw">nrow</span>(Female),</span>
<span id="cb148-13"><a href="RCT.html#cb148-13"></a>                              <span class="dt">n_treated =</span> n_treated[<span class="dv">2</span>])</span>
<span id="cb148-14"><a href="RCT.html#cb148-14"></a>  male_prop &lt;-<span class="st"> </span><span class="kw">mean</span>(df<span class="op">$</span>male)</span>
<span id="cb148-15"><a href="RCT.html#cb148-15"></a>  ATE &lt;-<span class="st"> </span>male_prop <span class="op">*</span><span class="st"> </span>ATE_male <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>male_prop) <span class="op">*</span><span class="st"> </span>ATE_female</span>
<span id="cb148-16"><a href="RCT.html#cb148-16"></a>  <span class="cf">if</span> (info) {</span>
<span id="cb148-17"><a href="RCT.html#cb148-17"></a>    <span class="kw">cat</span>(<span class="st">&#39;男性ブロック 処置群の個体数&#39;</span>, n_treated[<span class="dv">1</span>], <span class="st">&#39;; 統制群の個体数:&#39;</span>, <span class="kw">nrow</span>(Male) <span class="op">-</span><span class="st"> </span>n_treated[<span class="dv">1</span>], <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)</span>
<span id="cb148-18"><a href="RCT.html#cb148-18"></a>    <span class="kw">cat</span>(<span class="st">&#39;女性ブロック 処置群の個体数&#39;</span>, n_treated[<span class="dv">2</span>], <span class="st">&#39;; 統制群の個体数:&#39;</span>, <span class="kw">nrow</span>(Female) <span class="op">-</span><span class="st"> </span>n_treated[<span class="dv">2</span>], <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)</span>
<span id="cb148-19"><a href="RCT.html#cb148-19"></a>  }</span>
<span id="cb148-20"><a href="RCT.html#cb148-20"></a>  <span class="kw">return</span>(ATE)</span>
<span id="cb148-21"><a href="RCT.html#cb148-21"></a>}</span></code></pre></div>
<p><code>sample_size = 100</code>、<code>prop = c(0.5, 0.5)</code> （どちらも既定値）として、1回実験してみる。</p>
<div class="sourceCode" id="cb149"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb149-1"><a href="RCT.html#cb149-1"></a><span class="kw">strat_experiment</span>(df_pop, <span class="dt">info =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<pre><code>## 男性ブロック 処置群の個体数 28 ; 統制群の個体数: 27 
## 女性ブロック 処置群の個体数 23 ; 統制群の個体数: 22</code></pre>
<pre><code>## [1] 8.558515</code></pre>
<p>もう1度やってみる</p>
<div class="sourceCode" id="cb152"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb152-1"><a href="RCT.html#cb152-1"></a><span class="kw">strat_experiment</span>(df_pop, <span class="dt">info =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<pre><code>## 男性ブロック 処置群の個体数 26 ; 統制群の個体数: 26 
## 女性ブロック 処置群の個体数 24 ; 統制群の個体数: 24</code></pre>
<pre><code>## [1] 8.715336</code></pre>
<p>この実験を1000回繰り返し、結果を可視化しよう。</p>
<div class="sourceCode" id="cb155"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb155-1"><a href="RCT.html#cb155-1"></a>strat_<span class="dv">100</span> &lt;-<span class="st"> </span><span class="kw">replicate</span>(<span class="dv">1000</span>, <span class="kw">strat_experiment</span>(df_pop))</span>
<span id="cb155-2"><a href="RCT.html#cb155-2"></a>hist_strat_<span class="dv">100</span> &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">ATE =</span> strat_<span class="dv">100</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb155-3"><a href="RCT.html#cb155-3"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> ATE)) <span class="op">+</span></span>
<span id="cb155-4"><a href="RCT.html#cb155-4"></a><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">binwidth =</span> <span class="fl">0.2</span>, <span class="dt">color =</span> <span class="st">&quot;black&quot;</span>) <span class="op">+</span></span>
<span id="cb155-5"><a href="RCT.html#cb155-5"></a><span class="st">  </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> pop_ATE, <span class="dt">color =</span> <span class="st">&quot;tomato&quot;</span>) <span class="op">+</span></span>
<span id="cb155-6"><a href="RCT.html#cb155-6"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">y =</span> <span class="st">&quot;度数&quot;</span>, <span class="dt">title =</span> <span class="st">&quot;ブロック別ランダム化実験&quot;</span>)</span>
<span id="cb155-7"><a href="RCT.html#cb155-7"></a><span class="kw">plot</span>(hist_strat_<span class="dv">100</span>)</span></code></pre></div>
<p><img src="kut-metrics2_files/figure-html/unnamed-chunk-91-1.png" width="384" /></p>
<p>やはり、平均的にはうまく推定できているようだ。ATEの推定値の平均値は、9.01 である。</p>
<p>処置する個体の数（割合）は、ブロックごとに変えても良い。</p>
<div class="sourceCode" id="cb156"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb156-1"><a href="RCT.html#cb156-1"></a><span class="kw">strat_experiment</span>(df_pop, <span class="dt">prop =</span> <span class="kw">c</span>(<span class="fl">0.3</span>, <span class="fl">0.15</span>), <span class="dt">info =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<pre><code>## 男性ブロック 処置群の個体数 17 ; 統制群の個体数: 38 
## 女性ブロック 処置群の個体数 7 ; 統制群の個体数: 38</code></pre>
<pre><code>## [1] 9.260837</code></pre>
<div class="sourceCode" id="cb159"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb159-1"><a href="RCT.html#cb159-1"></a><span class="kw">strat_experiment</span>(df_pop, <span class="dt">prop =</span> <span class="kw">c</span>(<span class="fl">0.8</span>, <span class="fl">0.1</span>), <span class="dt">info =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<pre><code>## 男性ブロック 処置群の個体数 42 ; 統制群の個体数: 10 
## 女性ブロック 処置群の個体数 5 ; 統制群の個体数: 43</code></pre>
<pre><code>## [1] 9.769045</code></pre>
<p>1000回繰り返してみよう。</p>
<div class="sourceCode" id="cb162"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb162-1"><a href="RCT.html#cb162-1"></a>strat_b &lt;-<span class="st"> </span><span class="kw">replicate</span>(<span class="dv">1000</span>, <span class="kw">strat_experiment</span>(df_pop, <span class="dt">prop =</span> <span class="kw">c</span>(<span class="fl">0.8</span>, <span class="fl">0.2</span>)))</span>
<span id="cb162-2"><a href="RCT.html#cb162-2"></a>hist_strat_b &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">ATE =</span> strat_b) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb162-3"><a href="RCT.html#cb162-3"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> ATE)) <span class="op">+</span></span>
<span id="cb162-4"><a href="RCT.html#cb162-4"></a><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">binwidth =</span> <span class="fl">0.2</span>, <span class="dt">color =</span> <span class="st">&quot;black&quot;</span>) <span class="op">+</span></span>
<span id="cb162-5"><a href="RCT.html#cb162-5"></a><span class="st">  </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> pop_ATE, <span class="dt">color =</span> <span class="st">&quot;tomato&quot;</span>) <span class="op">+</span></span>
<span id="cb162-6"><a href="RCT.html#cb162-6"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">y =</span> <span class="st">&quot;度数&quot;</span>)</span>
<span id="cb162-7"><a href="RCT.html#cb162-7"></a><span class="kw">plot</span>(hist_strat_b)</span></code></pre></div>
<p><img src="kut-metrics2_files/figure-html/unnamed-chunk-94-1.png" width="384" /></p>
<p>ブロックごとに処置に割り付ける割合が違っても、平均的には正しい推定ができる。</p>
</div>
<div id="ペア毎のランダム化実験" class="section level3" number="3.2.5">
<h3><span class="header-section-number">3.2.5</span> ペア毎のランダム化実験</h3>
<p>4番目の方法として、ペア毎のランダム化試験 (paired randomized experiments) を実施しよう。
サンプルの中で、性別が同じで、年齢が近い者同士をペアにして、ペア毎に一方を処置に、他方を統制に割付ける。
ペアを組む都合上、標本サイズは偶数に制限し、サンプル内の男女の数がそれぞれ偶数になるように調整する。</p>
<div class="sourceCode" id="cb163"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb163-1"><a href="RCT.html#cb163-1"></a>paired_experiment &lt;-<span class="st"> </span><span class="cf">function</span>(population, <span class="dt">sample_size =</span> <span class="dv">100</span>) {</span>
<span id="cb163-2"><a href="RCT.html#cb163-2"></a>  </span>
<span id="cb163-3"><a href="RCT.html#cb163-3"></a>  <span class="co">## sample_size が奇数の場合はエラー</span></span>
<span id="cb163-4"><a href="RCT.html#cb163-4"></a>  <span class="cf">if</span> (sample_size <span class="op">%%</span><span class="st"> </span><span class="dv">2</span> <span class="op">!=</span><span class="st"> </span><span class="dv">0</span>) <span class="kw">stop</span>(<span class="st">&quot;sample_size must be an even number.&quot;</span>)</span>
<span id="cb163-5"><a href="RCT.html#cb163-5"></a>  </span>
<span id="cb163-6"><a href="RCT.html#cb163-6"></a>  n_male &lt;-<span class="st"> </span>sample_size <span class="op">/</span><span class="st"> </span><span class="dv">2</span></span>
<span id="cb163-7"><a href="RCT.html#cb163-7"></a>  <span class="cf">if</span> (n_male <span class="op">%%</span><span class="st"> </span><span class="dv">2</span> <span class="op">!=</span><span class="st"> </span><span class="dv">0</span>) n_male &lt;-<span class="st"> </span>n_male <span class="op">+</span><span class="st"> </span><span class="kw">sample</span>(<span class="kw">c</span>(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>), <span class="dt">size =</span> <span class="dv">1</span>)</span>
<span id="cb163-8"><a href="RCT.html#cb163-8"></a>  n_female &lt;-<span class="st"> </span>sample_size <span class="op">-</span><span class="st"> </span>n_male</span>
<span id="cb163-9"><a href="RCT.html#cb163-9"></a></span>
<span id="cb163-10"><a href="RCT.html#cb163-10"></a>  Male &lt;-<span class="st"> </span>population <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb163-11"><a href="RCT.html#cb163-11"></a><span class="st">    </span><span class="kw">filter</span>(male <span class="op">==</span><span class="st"> </span><span class="dv">1</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb163-12"><a href="RCT.html#cb163-12"></a><span class="st">    </span><span class="kw">slice_sample</span>(<span class="dt">n =</span> n_male) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb163-13"><a href="RCT.html#cb163-13"></a><span class="st">    </span><span class="kw">arrange</span>(age) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb163-14"><a href="RCT.html#cb163-14"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">D =</span> <span class="kw">as.vector</span>(<span class="kw">replicate</span>(<span class="kw">n</span>() <span class="op">/</span><span class="st"> </span><span class="dv">2</span>, <span class="kw">sample</span>(<span class="dv">0</span><span class="op">:</span><span class="dv">1</span>, <span class="dt">size =</span> <span class="dv">2</span>))))</span>
<span id="cb163-15"><a href="RCT.html#cb163-15"></a>  Female &lt;-<span class="st"> </span>population <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb163-16"><a href="RCT.html#cb163-16"></a><span class="st">    </span><span class="kw">filter</span>(male <span class="op">==</span><span class="st"> </span><span class="dv">0</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb163-17"><a href="RCT.html#cb163-17"></a><span class="st">    </span><span class="kw">slice_sample</span>(<span class="dt">n =</span> n_female) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb163-18"><a href="RCT.html#cb163-18"></a><span class="st">    </span><span class="kw">arrange</span>(age) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb163-19"><a href="RCT.html#cb163-19"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">D =</span> <span class="kw">as.vector</span>(<span class="kw">replicate</span>(<span class="kw">n</span>() <span class="op">/</span><span class="st"> </span><span class="dv">2</span>, <span class="kw">sample</span>(<span class="dv">0</span><span class="op">:</span><span class="dv">1</span>, <span class="dt">size =</span> <span class="dv">2</span>))))</span>
<span id="cb163-20"><a href="RCT.html#cb163-20"></a>  df &lt;-<span class="st"> </span><span class="kw">bind_rows</span>(Male, Female)</span>
<span id="cb163-21"><a href="RCT.html#cb163-21"></a>  ATE &lt;-<span class="st"> </span><span class="kw">with</span>(df, <span class="kw">mean</span>(y_<span class="dv">1</span>[D <span class="op">==</span><span class="st"> </span><span class="dv">1</span>]) <span class="op">-</span><span class="st"> </span><span class="kw">mean</span>(y_<span class="dv">0</span>[D <span class="op">==</span><span class="st"> </span><span class="dv">0</span>]))</span>
<span id="cb163-22"><a href="RCT.html#cb163-22"></a>  <span class="kw">return</span>(ATE)</span>
<span id="cb163-23"><a href="RCT.html#cb163-23"></a>}</span></code></pre></div>
<p>標本サイズ <code>sample_size = 100</code> （既定値）で1回実験してみる。</p>
<div class="sourceCode" id="cb164"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb164-1"><a href="RCT.html#cb164-1"></a><span class="kw">paired_experiment</span>(df_pop)</span></code></pre></div>
<pre><code>## [1] 8.230426</code></pre>
<p>もう1回やってみよう。</p>
<div class="sourceCode" id="cb166"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb166-1"><a href="RCT.html#cb166-1"></a><span class="kw">paired_experiment</span>(df_pop)</span></code></pre></div>
<pre><code>## [1] 8.688203</code></pre>
<p>この実験を1000回繰り返し、結果を可視化しよう（そこそこ時間がかかるので注意）。</p>
<div class="sourceCode" id="cb168"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb168-1"><a href="RCT.html#cb168-1"></a>pair_<span class="dv">100</span> &lt;-<span class="st"> </span><span class="kw">replicate</span>(<span class="dv">1000</span>, <span class="kw">paired_experiment</span>(df_pop))</span>
<span id="cb168-2"><a href="RCT.html#cb168-2"></a>hist_pair_<span class="dv">100</span> &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">ATE =</span> pair_<span class="dv">100</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb168-3"><a href="RCT.html#cb168-3"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> ATE)) <span class="op">+</span></span>
<span id="cb168-4"><a href="RCT.html#cb168-4"></a><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">binwidth =</span> <span class="fl">0.2</span>, <span class="dt">color =</span> <span class="st">&quot;black&quot;</span>) <span class="op">+</span></span>
<span id="cb168-5"><a href="RCT.html#cb168-5"></a><span class="st">  </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> pop_ATE, <span class="dt">color =</span> <span class="st">&quot;tomato&quot;</span>) <span class="op">+</span></span>
<span id="cb168-6"><a href="RCT.html#cb168-6"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">y =</span> <span class="st">&quot;度数&quot;</span>, <span class="dt">title =</span> <span class="st">&quot;ペア毎のランダム化実験&quot;</span>)</span>
<span id="cb168-7"><a href="RCT.html#cb168-7"></a><span class="kw">plot</span>(hist_pair_<span class="dv">100</span>)</span></code></pre></div>
<p><img src="kut-metrics2_files/figure-html/unnamed-chunk-98-1.png" width="384" /></p>
<p>やはり、平均的にはうまく推定できているようだ。ATEの推定値の平均値は、9.02 である。</p>
<p>各ペアで処置に割り付ける確率は、0.5 でなくても良い。自分で確かめてみよう。</p>
</div>
<div id="つのrct-を比較する" class="section level3" number="3.2.6">
<h3><span class="header-section-number">3.2.6</span> 4つのRCT を比較する</h3>
<p>最後に、それぞれのRCTの推定精度を比較しよう。どれも標本サイズは100で、処置の確率・割合・数が全体の半分（程度）になるようにしたものを比べる。</p>
<p>1000回の実験をシミュレートしたヒストグラムを再掲する。</p>
<div class="sourceCode" id="cb169"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb169-1"><a href="RCT.html#cb169-1"></a>MIN &lt;-<span class="st"> </span><span class="kw">min</span>(<span class="kw">c</span>(bern_<span class="dv">100</span>, cr_<span class="dv">100</span>, strat_<span class="dv">100</span>, pair_<span class="dv">100</span>)) <span class="op">-</span><span class="st"> </span><span class="fl">0.2</span></span>
<span id="cb169-2"><a href="RCT.html#cb169-2"></a>MAX &lt;-<span class="st"> </span><span class="kw">max</span>(<span class="kw">c</span>(bern_<span class="dv">100</span>, cr_<span class="dv">100</span>, strat_<span class="dv">100</span>, pair_<span class="dv">100</span>)) <span class="op">+</span><span class="st"> </span><span class="fl">0.2</span></span>
<span id="cb169-3"><a href="RCT.html#cb169-3"></a>((hist_bern_<span class="dv">100</span>  <span class="op">+</span><span class="st"> </span><span class="kw">xlim</span>(MIN, MAX) <span class="op">+</span><span class="st"> </span><span class="kw">ylim</span>(<span class="dv">0</span>, <span class="dv">150</span>)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb169-4"><a href="RCT.html#cb169-4"></a><span class="st">    </span>(hist_cr_<span class="dv">100</span> <span class="op">+</span><span class="st"> </span><span class="kw">xlim</span>(MIN, MAX) <span class="op">+</span><span class="st"> </span><span class="kw">ylim</span>(<span class="dv">0</span>, <span class="dv">150</span>))) <span class="op">/</span></span>
<span id="cb169-5"><a href="RCT.html#cb169-5"></a><span class="st">  </span>((hist_strat_<span class="dv">100</span> <span class="op">+</span><span class="st"> </span><span class="kw">xlim</span>(MIN, MAX) <span class="op">+</span><span class="st"> </span><span class="kw">ylim</span>(<span class="dv">0</span>, <span class="dv">150</span>)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb169-6"><a href="RCT.html#cb169-6"></a><span class="st">     </span>(hist_pair_<span class="dv">100</span> <span class="op">+</span><span class="st"> </span><span class="kw">xlim</span>(MIN, MAX) <span class="op">+</span><span class="st"> </span><span class="kw">ylim</span>(<span class="dv">0</span>, <span class="dv">150</span>)))</span></code></pre></div>
<p><img src="kut-metrics2_files/figure-html/unnamed-chunk-99-1.png" width="576" /></p>
<p>標準誤差を比較する。</p>
<div class="sourceCode" id="cb170"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb170-1"><a href="RCT.html#cb170-1"></a><span class="kw">sd</span>(bern_<span class="dv">100</span>)</span></code></pre></div>
<pre><code>## [1] 0.7140102</code></pre>
<div class="sourceCode" id="cb172"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb172-1"><a href="RCT.html#cb172-1"></a><span class="kw">sd</span>(cr_<span class="dv">100</span>)</span></code></pre></div>
<pre><code>## [1] 0.6964512</code></pre>
<div class="sourceCode" id="cb174"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb174-1"><a href="RCT.html#cb174-1"></a><span class="kw">sd</span>(strat_<span class="dv">100</span>)</span></code></pre></div>
<pre><code>## [1] 0.6364027</code></pre>
<div class="sourceCode" id="cb176"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb176-1"><a href="RCT.html#cb176-1"></a><span class="kw">sd</span>(pair_<span class="dv">100</span>)</span></code></pre></div>
<pre><code>## [1] 0.6304716</code></pre>
<p>このように、処置のパタンの数が最も少ない（かつブロック[ペア]がより同質的な）ペア毎のランダム化実験の標準誤差が最も小さく、推定精度が高いことがわかる。</p>
<p>経済実験におけるランダム化について、さらに詳細な説明は <span class="citation">List, Sadoff, and Wagner (<a href="#ref-list2011" role="doc-biblioref">2011</a>)</span> を参照。また、RCT全般については、実験経済学（岡野先生）と実験デザイン（小谷先生）の授業で詳しく扱うはずなので、それらの授業まだ受講していない人はぜひ受講してほしい。</p>
</div>
</div>
<div id="トピック3の課題" class="section level2" number="3.3">
<h2><span class="header-section-number">3.3</span> トピック3の課題</h2>
<ul>
<li>上で行ったシミュレーションを、条件を変えて試し、どのような場合に実験がうまくいき、どのような条件だと失敗しやすいか研究しなさい。また、面白い結果や納得できない結果が出たら、Slack でシェアし、受講生同士で議論しなさい。</li>
<li>教科書 <span class="citation">(安井 <a href="#ref-yasui2020" role="doc-biblioref">2020</a>)</span> 第1章の1.4節 (pp.24-33) の分析を自分で実行しなさい。</li>
</ul>
<p>今回の課題はいずれも<strong>提出不要</strong>だが、必ず自分で実行すること。</p>

</div>
</div>
<h3>参考文献</h3>
<div id="refs" class="references">
<div id="ref-list2011">
<p>List, John A., Sally Sadoff, and Mathis Wagner. 2011. “So You Want to Run an Experiment, Now What? Some Simple Rules of Thumb for Optimal Experimental Design.” <em>Experimental Economics</em> 14: 439. <a href="https://doi.org/10.1007/s10683-011-9275-7">https://doi.org/10.1007/s10683-011-9275-7</a>.</p>
</div>
<div id="ref-yasui2020">
<p>安井翔太. 2020. <em>効果検証入門：正しい比較のための因果推論/計量経済学の基礎</em>. 技術評論社.</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="selection-bias.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="regression.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
